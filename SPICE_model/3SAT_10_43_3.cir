*  [  1  -2  -3   4   5   6   7   8   9 -10]
XV1 R2_1 R12_2 R16_2 R24_3 R34_2 0 0 0 0 0 G2_1 G12_2 G16_2 G24_3 G34_2 0 0 0 0 0 x2 x12 x16 x24 x34 -1V -1V -1V -1V -1V R9_3 R10_3 R13_2 R15_1 R18_2 R30_3 R33_3 R43_3 0 0 G9_3 G10_3 G13_2 G15_1 G18_2 G30_3 G33_3 G43_3 0 0 x9 x10 x13 x15 x18 x30 x33 x43 -1V -1V  1 -1 v_10_softmax
XV2 R3_3 R13_1 R19_3 R31_1 R35_3 R36_1 R37_2 R39_3 R40_1 R41_3 G3_3 G13_1 G19_3 G31_1 G35_3 G36_1 G37_2 G39_3 G40_1 G41_3 x3 x13 x19 x31 x35 x36 x37 x39 x40 x41 R4_2 R6_2 R7_1 R16_1 R17_1 R27_3 R29_2 R30_2 R33_2 R42_1 G4_2 G6_2 G7_1 G16_1 G17_1 G27_3 G29_2 G30_2 G33_2 G42_1 x4 x6 x7 x16 x17 x27 x29 x30 x33 x42  2 -2 v_10_softmax
XV3 R6_1 R9_2 R16_3 R19_1 R32_2 0 0 0 0 0 G6_1 G9_2 G16_3 G19_1 G32_2 0 0 0 0 0 x6 x9 x16 x19 x32 -1V -1V -1V -1V -1V R14_3 R15_3 R18_1 R21_1 R25_2 R40_2 R42_2 R43_1 0 0 G14_3 G15_3 G18_1 G21_1 G25_2 G40_2 G42_2 G43_1 0 0 x14 x15 x18 x21 x25 x40 x42 x43 -1V -1V  3 -3 v_10_softmax
XV4 R3_2 R8_1 R13_3 R32_3 0 0 0 0 0 0 G3_2 G8_1 G13_3 G32_3 0 0 0 0 0 0 x3 x8 x13 x32 -1V -1V -1V -1V -1V -1V R1_3 R5_2 R17_3 R20_2 R29_3 R38_1 R42_3 0 0 0 G1_3 G5_2 G17_3 G20_2 G29_3 G38_1 G42_3 0 0 0 x1 x5 x17 x20 x29 x38 x42 -1V -1V -1V  4 -4 v_10_softmax
XV5 R10_2 R28_1 R37_3 R41_1 R43_2 0 0 0 0 0 G10_2 G28_1 G37_3 G41_1 G43_2 0 0 0 0 0 x10 x28 x37 x41 x43 -1V -1V -1V -1V -1V R2_2 R8_2 R11_2 R12_1 R22_2 0 0 0 0 0 G2_2 G8_2 G11_2 G12_1 G22_2 0 0 0 0 0 x2 x8 x11 x12 x22 -1V -1V -1V -1V -1V  5 -5 v_10_softmax
XV6 R11_1 R18_3 R26_3 R31_2 R36_2 R39_1 0 0 0 0 G11_1 G18_3 G26_3 G31_2 G36_2 G39_1 0 0 0 0 x11 x18 x26 x31 x36 x39 -1V -1V -1V -1V R1_1 R5_1 R20_3 R33_1 R35_2 0 0 0 0 0 G1_1 G5_1 G20_3 G33_1 G35_2 0 0 0 0 0 x1 x5 x20 x33 x35 -1V -1V -1V -1V -1V  6 -6 v_10_softmax
XV7 R20_1 R22_1 R34_3 0 0 0 0 0 0 0 G20_1 G22_1 G34_3 0 0 0 0 0 0 0 x20 x22 x34 -1V -1V -1V -1V -1V -1V -1V R10_1 R24_2 R31_3 0 0 0 0 0 0 0 G10_1 G24_2 G31_3 0 0 0 0 0 0 0 x10 x24 x31 -1V -1V -1V -1V -1V -1V -1V  7 -7 v_10_softmax
XV8 R14_2 R26_1 R27_2 R38_2 0 0 0 0 0 0 G14_2 G26_1 G27_2 G38_2 0 0 0 0 0 0 x14 x26 x27 x38 -1V -1V -1V -1V -1V -1V R4_3 R7_3 R15_2 R22_3 R23_2 R25_3 R28_3 R30_1 R39_2 0 G4_3 G7_3 G15_2 G22_3 G23_2 G25_3 G28_3 G30_1 G39_2 0 x4 x7 x15 x22 x23 x25 x28 x30 x39 -1V  8 -8 v_10_softmax
XV9 R14_1 R19_2 R23_1 R32_1 R37_1 R40_3 0 0 0 0 G14_1 G19_2 G23_1 G32_1 G37_1 G40_3 0 0 0 0 x14 x19 x23 x32 x37 x40 -1V -1V -1V -1V R3_1 R7_2 R17_2 R21_3 R24_1 R34_1 R38_3 R41_2 0 0 G3_1 G7_2 G17_2 G21_3 G24_1 G34_1 G38_3 G41_2 0 0 x3 x7 x17 x21 x24 x34 x38 x41 -1V -1V  9 -9 v_10_softmax
XV10 R2_3 R4_1 R6_3 R8_3 R12_3 R21_2 R25_1 R26_2 R28_2 0 G2_3 G4_1 G6_3 G8_3 G12_3 G21_2 G25_1 G26_2 G28_2 0 x2 x4 x6 x8 x12 x21 x25 x26 x28 -1V R1_2 R5_3 R9_1 R11_3 R23_3 R27_1 R29_1 R35_1 R36_3 0 G1_2 G5_3 G9_1 G11_3 G23_3 G27_1 G29_1 G35_1 G36_3 0 x1 x5 x9 x11 x23 x27 x29 x35 x36 -1V  10 -10 v_10_softmax
XSOLG1 -6 -10 -4 G1_1 G1_2 G1_3 R1_1 R1_2 R1_3 x1 solg_softmax
XSOLG2 1 -5 10 G2_1 G2_2 G2_3 R2_1 R2_2 R2_3 x2 solg_softmax
XSOLG3 -9 4 2 G3_1 G3_2 G3_3 R3_1 R3_2 R3_3 x3 solg_softmax
XSOLG4 10 -2 -8 G4_1 G4_2 G4_3 R4_1 R4_2 R4_3 x4 solg_softmax
XSOLG5 -6 -4 -10 G5_1 G5_2 G5_3 R5_1 R5_2 R5_3 x5 solg_softmax
XSOLG6 3 -2 10 G6_1 G6_2 G6_3 R6_1 R6_2 R6_3 x6 solg_softmax
XSOLG7 -2 -9 -8 G7_1 G7_2 G7_3 R7_1 R7_2 R7_3 x7 solg_softmax
XSOLG8 4 -5 10 G8_1 G8_2 G8_3 R8_1 R8_2 R8_3 x8 solg_softmax
XSOLG9 -10 3 -1 G9_1 G9_2 G9_3 R9_1 R9_2 R9_3 x9 solg_softmax
XSOLG10 -7 5 -1 G10_1 G10_2 G10_3 R10_1 R10_2 R10_3 x10 solg_softmax
XSOLG11 6 -5 -10 G11_1 G11_2 G11_3 R11_1 R11_2 R11_3 x11 solg_softmax
XSOLG12 -5 1 10 G12_1 G12_2 G12_3 R12_1 R12_2 R12_3 x12 solg_softmax
XSOLG13 2 -1 4 G13_1 G13_2 G13_3 R13_1 R13_2 R13_3 x13 solg_softmax
XSOLG14 9 8 -3 G14_1 G14_2 G14_3 R14_1 R14_2 R14_3 x14 solg_softmax
XSOLG15 -1 -8 -3 G15_1 G15_2 G15_3 R15_1 R15_2 R15_3 x15 solg_softmax
XSOLG16 -2 1 3 G16_1 G16_2 G16_3 R16_1 R16_2 R16_3 x16 solg_softmax
XSOLG17 -2 -9 -4 G17_1 G17_2 G17_3 R17_1 R17_2 R17_3 x17 solg_softmax
XSOLG18 -3 -1 6 G18_1 G18_2 G18_3 R18_1 R18_2 R18_3 x18 solg_softmax
XSOLG19 3 9 2 G19_1 G19_2 G19_3 R19_1 R19_2 R19_3 x19 solg_softmax
XSOLG20 7 -4 -6 G20_1 G20_2 G20_3 R20_1 R20_2 R20_3 x20 solg_softmax
XSOLG21 -3 10 -9 G21_1 G21_2 G21_3 R21_1 R21_2 R21_3 x21 solg_softmax
XSOLG22 7 -5 -8 G22_1 G22_2 G22_3 R22_1 R22_2 R22_3 x22 solg_softmax
XSOLG23 9 -8 -10 G23_1 G23_2 G23_3 R23_1 R23_2 R23_3 x23 solg_softmax
XSOLG24 -9 -7 1 G24_1 G24_2 G24_3 R24_1 R24_2 R24_3 x24 solg_softmax
XSOLG25 10 -3 -8 G25_1 G25_2 G25_3 R25_1 R25_2 R25_3 x25 solg_softmax
XSOLG26 8 10 6 G26_1 G26_2 G26_3 R26_1 R26_2 R26_3 x26 solg_softmax
XSOLG27 -10 8 -2 G27_1 G27_2 G27_3 R27_1 R27_2 R27_3 x27 solg_softmax
XSOLG28 5 10 -8 G28_1 G28_2 G28_3 R28_1 R28_2 R28_3 x28 solg_softmax
XSOLG29 -10 -2 -4 G29_1 G29_2 G29_3 R29_1 R29_2 R29_3 x29 solg_softmax
XSOLG30 -8 -2 -1 G30_1 G30_2 G30_3 R30_1 R30_2 R30_3 x30 solg_softmax
XSOLG31 2 6 -7 G31_1 G31_2 G31_3 R31_1 R31_2 R31_3 x31 solg_softmax
XSOLG32 9 3 4 G32_1 G32_2 G32_3 R32_1 R32_2 R32_3 x32 solg_softmax
XSOLG33 -6 -2 -1 G33_1 G33_2 G33_3 R33_1 R33_2 R33_3 x33 solg_softmax
XSOLG34 -9 1 7 G34_1 G34_2 G34_3 R34_1 R34_2 R34_3 x34 solg_softmax
XSOLG35 -10 -6 2 G35_1 G35_2 G35_3 R35_1 R35_2 R35_3 x35 solg_softmax
XSOLG36 2 6 -10 G36_1 G36_2 G36_3 R36_1 R36_2 R36_3 x36 solg_softmax
XSOLG37 9 2 5 G37_1 G37_2 G37_3 R37_1 R37_2 R37_3 x37 solg_softmax
XSOLG38 -4 8 -9 G38_1 G38_2 G38_3 R38_1 R38_2 R38_3 x38 solg_softmax
XSOLG39 6 -8 2 G39_1 G39_2 G39_3 R39_1 R39_2 R39_3 x39 solg_softmax
XSOLG40 2 -3 9 G40_1 G40_2 G40_3 R40_1 R40_2 R40_3 x40 solg_softmax
XSOLG41 5 -9 2 G41_1 G41_2 G41_3 R41_1 R41_2 R41_3 x41 solg_softmax
XSOLG42 -2 -3 -4 G42_1 G42_2 G42_3 R42_1 R42_2 R42_3 x42 solg_softmax
XSOLG43 -3 5 -1 G43_1 G43_2 G43_3 R43_1 R43_2 R43_3 x43 solg_softmax
V4 -1V 0 -1

* block symbol definitions
.subckt solg_softmax V1 V2 V3 dV1 dV2 dV3 R1 R2 R3 xl
XSOLG V1 V2 V3 N003 dV1 dV2 dV3 N001 N002 R1 R2 R3 self_organizing_or_softmax
Xxl N001 xl xl_softmax
Xxs N002 N003 xs
.ends solg_softmax

.subckt v_10_softmax +R0 +R1 +R2 +R3 +R4 +R5 +R6 +R7 +R8 +R9 +V0 +V1 +V2 +V3 +V4 +V5 +V6 +V7 +V8 +V9 +xl0 +xl1 +xl2 +xl3 +xl4 +xl5 +xl6 +xl7 +xl8 +xl9 -R0 -R1 -R2 -R3 -R4 -R5 -R6 -R7 -R8 -R9 -V0 -V1 -V2 -V3 -V4 -V5 -V6 -V7 -V8 -V9 -xl0 -xl1 -xl2 -xl3 -xl4 -xl5 -xl6 -xl7 -xl8 -xl9 V Vbar
C1 N001 0 10n
XBidirectionalSwitch1 ctrl+ ctrl- N005 N004 bidirectional_switch_pm
XSubtractor1 G- G+ N005 subtractor
G1 0 N001 N004 0 3m
XInvertAdderG+ +g0 +g1 +g2 +g3 +g4 +g5 +g6 +g7 +g8 +g9 G+ invert_adder_10
XInvertAddeG- -g0 -g1 -g2 -g3 -g4 -g5 -g6 -g7 -g8 -g9 G- invert_adder_10
XSoftmax +xl0 +xl1 +xl2 +xl3 +xl4 +xl5 +xl6 +xl7 +xl8 +xl9 -xl0 -xl1 -xl2 -xl3 -xl4 -xl5 -xl6 -xl7 -xl8 -xl9 +s0 +s1 +s2 +s3 +s4 +s5 +s6 +s7 +s8 +s9 -s0 -s1 -s2 -s3 -s4 -s5 -s6 -s7 -s8 -s9 softmax_20
XMultiplier0 +s0 +V0 +g0 multiplier
XMultiplier1 +s1 +V1 +g1 multiplier
XMultiplier2 +s2 +V2 +g2 multiplier
XMultiplier3 +s3 +V3 +g3 multiplier
XMultiplier4 +s4 +V4 +g4 multiplier
XMultiplier5 +s5 +V5 +g5 multiplier
XMultiplier6 +s6 +V6 +g6 multiplier
XMultiplier7 +s7 +V7 +g7 multiplier
XMultiplier8 +s8 +V8 +g8 multiplier
XMultiplier9 +s9 +V9 +g9 multiplier
XMultiplier10 -s0 -V0 -g0 multiplier
XMultiplier11 -s1 -V1 -g1 multiplier
XMultiplier12 -s2 -V2 -g2 multiplier
XMultiplier13 -s3 -V3 -g3 multiplier
XMultiplier14 -s4 -V4 -g4 multiplier
XMultiplier15 -s5 -V5 -g5 multiplier
XMultiplier16 -s6 -V6 -g6 multiplier
XMultiplier17 -s7 -V7 -g7 multiplier
XMultiplier18 -s8 -V8 -g8 multiplier
XMultiplier19 -s9 -V9 -g9 multiplier
XBidirectionalSwitch2 ctrl+ ctrl- N003 N002 bidirectional_switch_pm
XSubtractor2 R- R+ N003 subtractor
G2 0 N001 N002 0 1µ
XInvertAdderR+ +R0 +R1 +R2 +R3 +R4 +R5 +R6 +R7 +R8 +R9 R+ invert_adder_10
XInvertAdderR- -R0 -R1 -R2 -R3 -R4 -R5 -R6 -R7 -R8 -R9 R- invert_adder_10
E1 V 0 N001 0 1
XX1 N006 N001 ctrl+ idealopamp_15
XX2 N001 0 ctrl- idealopamp_15
V1 N006 0 1
X1-V V Vbar one_minus_v
R1 N001 0 1T
.ends v_10_softmax

.subckt self_organizing_or_softmax V1 V2 V3 xs dV1 dV2 dV3 dxl dxs R1 R2 R3
XComparator V1 V2 V3 b1 b2 b3 N003 comparator
XSubtractor1 C gamma N002 subtractor
XSubtractor2 C -lambda dxl subtractor
V1 gamma 0 0.25
V2 -lambda 0 -0.1
XMultiplier1 C xs N004 multiplier
XMultiplier2 C N006 N005 multiplier
XSwitch1 b1 N005 R1 bidirectional_switch_amplified
XSwitch2 b2 N005 R2 bidirectional_switch_amplified
XSwitch3 b3 N005 R3 bidirectional_switch_amplified
XAdder4 xs epsilon N001 adder
V3 epsilon 0 0.001
XMultiplier5 N001 N002 dxs multiplier
XAdder_zeta1 N004 R1 dV1 adder_zeta
XAdder_zeta2 N004 R2 dV2 adder_zeta
XAdder_zeta3 N004 R3 dV3 adder_zeta
X1-V N003 C one_minus_v
X1-xs xs N006 one_minus_v
.ends self_organizing_or_softmax

.subckt xl_softmax dxl xl
C1 N008 0 10n
XBidirectionalSwitch +V ctrl1 N005 N009 bidirectional_switch_pm
G1 0 N008 N009 0 0.01061µ
G2 0 N003 dxl 0 1µ
XLogAmp1 N003 N004 log_amplifier
V3 -logld 0 1.89712
XAdder2 xl -logld N007 adder
XAdder1 xl N004 N001 adder_log10
XExp_shifted1 N001 N002 expamp_shifted
XExp_shifted2 N007 N006 expamp_shifted
XX1 N008 0 ctrl1 idealopamp_15
E1 xl 0 N008 0 1
V1 +V 0 15
XSubtractor N002 N006 N005 subtractor
R1 N008 0 1T
.ends xl_softmax

.subckt xs dxs xs
C1 N001 0 10n
V4 1 0 1
XBidirectionalSwitch ctrl2 ctrl1 dxs N002 bidirectional_switch_pm
G1 0 N001 N002 0 20µ
E1 xs 0 N001 0 table(0.001, 0.001, 0.999, 0.999)
XX1 1 N001 ctrl2 idealopamp_15
XX2 N001 0 ctrl1 idealopamp_15
R1 N001 0 1T
.ends xs

.subckt bidirectional_switch_pm Vctrl+ Vctrl- Vin Vout
M1 Vin Vctrl+ N001 N001 IRF530
M2 Vout Vctrl- N001 N001 IRF530
D1 N001 Vin IdealDiode
D2 N001 Vout IdealDiode
R7 0 Vout 1k
.model IdealDiode D(Ron=0)
.ends bidirectional_switch_pm

.subckt subtractor V+ V- Vout
E1 Vout 0 V+ V- 1
.ends subtractor

.subckt invert_adder_10 V0 V1 V2 V3 V4 V5 V6 V7 V8 V9 Vout
R1 N001 V1 1k
R3 N001 V3 1k
R2 N001 V2 1k
R4 N001 V4 1k
R5 N002 N001 1k
R6 N001 V5 1k
R7 N001 V7 1k
R8 N001 V6 1k
R9 N001 V8 1k
R10 N001 V9 1k
R11 N001 V0 1k
V1 +V 0 15
V2 -V 0 -15
E1 Vout 0 N002 0 1
XU1 0 N001 +V -V N002 level1 Avol=1Meg GBW=10Meg Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
.ends invert_adder_10

.subckt softmax_20 x00 x01 x02 x03 x04 x05 x06 x07 x08 x09 x10 x11 x12 x13 x14 x15 x16 x17 x18 x19 y00 y01 y02 y03 y04 y05 y06 y07 y08 y09 y10 y11 y12 y13 y14 y15 y16 y17 y18 y19
Q1 z00 x00 Iee 0 NPN
Q2 z01 x01 Iee 0 NPN
Q3 z02 x02 Iee 0 NPN
VCC Vcc 0 5
R1 Vcc z00 1k
R2 Vcc z01 1k
R3 Vcc z02 1k
IEE Iee 0 1m
Q4 z03 x03 Iee 0 NPN
Q5 z04 x04 Iee 0 NPN
Q6 z05 x05 Iee 0 NPN
R4 Vcc z03 1k
R5 Vcc z04 1k
R6 Vcc z05 1k
Q7 z06 x06 Iee 0 NPN
Q8 z07 x07 Iee 0 NPN
Q9 z08 x08 Iee 0 NPN
R7 Vcc z06 1k
R8 Vcc z07 1k
R9 Vcc z08 1k
Q10 z09 x09 Iee 0 NPN
Q11 z10 x10 Iee 0 NPN
Q12 z11 x11 Iee 0 NPN
R10 Vcc z09 1k
R11 Vcc z10 1k
R12 Vcc z11 1k
Q13 z12 x12 Iee 0 NPN
Q14 z13 x13 Iee 0 NPN
Q15 z14 x14 Iee 0 NPN
R13 Vcc z12 1k
R14 Vcc z13 1k
R15 Vcc z14 1k
Q16 z15 x15 Iee 0 NPN
Q17 z16 x16 Iee 0 NPN
Q18 z17 x17 Iee 0 NPN
R16 Vcc z15 1k
R17 Vcc z16 1k
R18 Vcc z17 1k
Q19 z18 x18 Iee 0 NPN
Q20 z19 x19 Iee 0 NPN
R19 Vcc z18 1k
R20 Vcc z19 1k
XSub0 Vcc z00 y00 subtractor
XSub1 Vcc z01 y01 subtractor
XSub2 Vcc z02 y02 subtractor
XSub3 Vcc z03 y03 subtractor
XSub4 Vcc z04 y04 subtractor
XSub5 Vcc z05 y05 subtractor
XSub6 Vcc z06 y06 subtractor
XSub7 Vcc z07 y07 subtractor
XSub8 Vcc z08 y08 subtractor
XSub9 Vcc z09 y09 subtractor
XSub10 Vcc z10 y10 subtractor
XSub11 Vcc z11 y11 subtractor
XSub12 Vcc z12 y12 subtractor
XSub13 Vcc z13 y13 subtractor
XSub14 Vcc z14 y14 subtractor
XSub15 Vcc z15 y15 subtractor
XSub16 Vcc z16 y16 subtractor
XSub17 Vcc z17 y17 subtractor
XSub18 Vcc z18 y18 subtractor
XSub19 Vcc z19 y19 subtractor
.ends softmax_20

.subckt multiplier X Y Vout
XU1 Y 0 N004 N003 N002 N001 X 0 AD834
V3 V+ 0 6
V4 V- 0 -6
R1 X 0 1k
R2 Y 0 1k
R3 V+ N001 62
C1 0 N001 1µ
R4 V- N004 4.7
C2 0 N004 1µ
V5 +12 0 12
V6 -12 0 -12
R7 0 N003 125
R8 Vout N002 125
XU2 N003 N002 +12 -12 Vout level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
.ends multiplier

.subckt idealopamp_15 + - Out
E1 Out 0 + - table=(-15u, -15, 15u, 15)
.ends idealopamp_15

.subckt one_minus_v v Vout
V1 P001 0 1
E1 Vout 0 P001 v 1
.ends one_minus_v

.subckt comparator V1 V2 V3 b1 b2 b3 Vmax
D1 N001 Vmax D
D2 N002 Vmax D
D3 N003 Vmax D
V1 +V 0 5
V2 -V 0 -5
XX2 V2 Vmax b2 idealopamp
XX3 V3 Vmax b3 idealopamp
XX1 V1 Vmax b1 idealopamp
XU1 V1 Vmax +V -V N001 level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
XU2 V2 Vmax +V -V N002 level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
XU3 V3 Vmax +V -V N003 level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
.ends comparator

.subckt bidirectional_switch_amplified Vctrl Vin Vout
M1 Vin N002 N001 N001 IRF530
M2 Vout N002 N001 N001 IRF530
D1 N001 Vin IdealDiode
D2 N001 Vout IdealDiode
R7 0 Vout 1k
E1 N002 0 Vctrl 0 table(-0.25, -5, 0.25, 5)
.model IdealDiode D(Ron=0)
.ends bidirectional_switch_amplified

.subckt adder V1 V2 Vout
R1 N001 V1 1k
R2 N001 V2 1k
R3 Vout N002 1k
R4 N002 0 1k
V1 +V 0 15
V2 -V 0 -15
XU1 N001 N002 +V -V Vout level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
.ends adder

.subckt adder_zeta V1 V2 Vout
R1 N001 V1 1k
R2 N001 V2 4545
R3 Vout N002 1k
R4 N002 0 4545
V1 +V 0 15
V2 -V 0 -15
XU1 N001 N002 +V -V Vout level1 Avol=1Meg GBW=10Meg Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
.ends adder_zeta

.subckt log_amplifier Input Vlogout
XLogAmp 0 Input Iref 0 -V 0 +V Vlogout +In4 -In4 VO4 NC_01 NC_02 NC_03 Vref LOG114
Iref P001 Iref 1µ
Rref P001 Vref 2500k
V1 +V 0 5
V2 -V 0 -5
R7 +In4 Vref 100k
R8 0 +In4 56.2k
R5 Vlogout -In4 100k
R6 -In4 VO4 66.5k
.ends log_amplifier

.subckt adder_log10 V1 V2 Vout
R1 N001 V1 1k
R2 N001 V2 162.86
R3 Vout N002 1k
R4 N002 0 162.86
V1 +V 0 15
V2 -V 0 -15
XU1 N001 N002 +V -V Vout level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
.ends adder_log10

.subckt expamp_shifted Vin Vout
XExp N002 Vout expamp
V1 N003 0 -180m
XAdder N001 N003 N002 adder
E1 N001 0 Vin 0 30m
.ends expamp_shifted

.subckt idealopamp + - Out
E1 Out 0 + - table=(-5u, -5, 5u, 5)
.ends idealopamp

.subckt expamp Vin Vout
Q1 N001 0 N002 0 NPN_1
V1 +V 0 15
V2 -V 0 -15
R1 N001 Vout 1k
Q2 N003 N004 N002 0 NPN_1
R2 N003 Vref 1k
Rtc N004 0 2568
R3 N004 Vin 432
V3 Vref 0 30m
XU1 0 N001 +V -V Vout level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
XU2 0 N003 +V -V N002 level1 Avol=1Meg GBW=10g Vos=0 En=0 Enk=0 In=0 Ink=0 Rin=500Meg
.MODEL NPN_1 NPN( IS= 1.50000000000000E-0017 NF=991M NR=991M RE=305M RC=1 RB=10 NC=1.5 BR=5 IKF=0 IKR=0 CJC=0 CJE=500F VJC=900M VJE=10M VJS=900M MJC=50M MJE=50M MJS=50M TF=15P TR=0)
.ends expamp

.model D D
.lib C:\Users\22361\AppData\Local\LTspice\lib\cmp\standard.dio
.model NPN NPN
.model PNP PNP
.lib C:\Users\22361\AppData\Local\LTspice\lib\cmp\standard.bjt
.model NMOS NMOS
.model PMOS PMOS
.lib C:\Users\22361\AppData\Local\LTspice\lib\cmp\standard.mos
.tran 100m uic
.options gmin=1e-10
.options abstol=1e-10
.options reltol=0.003
.options cshunt=1e-15
.lib C:\Research\Code\spice\scratches\ad834.cir
.lib C:\Research\Code\spice\v6_softmax\LOG114.LIB
.lib UniversalOpAmp1.lib
.backanno
.end
